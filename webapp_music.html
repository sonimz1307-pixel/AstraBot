<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>–ú—É–∑—ã–∫–∞ –±—É–¥—É—â–µ–≥–æ</title>
  <script>window.Telegram = window.Telegram || {};</script>
  <style>
    :root{
      --bg:#0b1220;
      --text:#e9f0ff;
      --muted:#9bb0d2;
      --line:rgba(255,255,255,.08);
      --accent:#2b8cff;
      --accent2:#1e6fe0;
      --radius:18px;
      --shadow:0 14px 35px rgba(0,0,0,.35);
      --shadow2:0 10px 20px rgba(0,0,0,.28);
      --font: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Arial, "Noto Sans", "Apple Color Emoji","Segoe UI Emoji";
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:var(--font);
      color:var(--text);
      background: radial-gradient(1200px 700px at 30% -10%, rgba(43,140,255,.35), transparent 55%),
                  radial-gradient(900px 600px at 95% 20%, rgba(36,209,143,.18), transparent 55%),
                  var(--bg);
      padding:16px 14px 28px;
    }
    .wrap{max-width:520px;margin:0 auto}
    .header{display:flex;align-items:center;justify-content:space-between;padding:10px 6px 14px}
    .brand{display:flex;gap:10px;align-items:center}
    .logo{width:34px;height:34px;border-radius:12px;background:linear-gradient(135deg, rgba(43,140,255,.95), rgba(36,209,143,.85));box-shadow:var(--shadow2)}
    .title{line-height:1.15}
    .title h1{font-size:16px;margin:0 0 2px 0;font-weight:750}
    .title div{font-size:12px;color:var(--muted)}
    .btn-help{
      border:1px solid var(--line);
      background:rgba(255,255,255,.06);
      color:var(--text);
      border-radius:14px;
      padding:9px 12px;
      cursor:pointer;
      font-weight:750;
    }
    .card{
      background:linear-gradient(180deg, rgba(255,255,255,.035), rgba(255,255,255,.02));
      border:1px solid var(--line);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:14px;
      margin:10px 0;
    }
    .row{display:flex;gap:10px;flex-wrap:wrap}
    .pillset{
      display:flex;gap:8px;flex-wrap:wrap;
      background:rgba(0,0,0,.12);
      border:1px solid var(--line);
      border-radius:16px;
      padding:8px;
    }
    .pill{
      padding:10px 12px;
      border-radius:14px;
      cursor:pointer;
      background:rgba(255,255,255,.05);
      color:var(--muted);
      font-weight:800;
      font-size:13px;
      user-select:none;
    }
    .pill.active{
      background:linear-gradient(135deg, rgba(43,140,255,.22), rgba(43,140,255,.10));
      color:var(--text);
      border:1px solid rgba(43,140,255,.35);
    }
    label{display:block;font-size:12px;color:var(--muted);margin:10px 2px 6px;font-weight:700}
    input, textarea, select{
      width:100%;
      padding:12px 12px;
      border-radius:16px;
      border:1px solid var(--line);
      background:rgba(0,0,0,.14);
      color:var(--text);
      outline:none;
      font-size:14px;
    }
    textarea{min-height:148px;resize:vertical;line-height:1.35}
    .hint{margin:8px 2px 0;font-size:12px;color:var(--muted);line-height:1.35}
    .divider{height:1px;background:var(--line);margin:12px 0}
    .switch{
      display:flex;align-items:center;gap:10px;
      padding:10px 12px;border:1px solid var(--line);
      border-radius:16px;background:rgba(0,0,0,.10);
    }
    .switch input{width:auto;transform:scale(1.1)}
    .actions{display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:space-between;margin-top:12px}
    .btn{border:none;border-radius:18px;padding:14px 14px;font-weight:850;cursor:pointer;font-size:14px;flex:1}
    .btn-primary{background:linear-gradient(135deg, var(--accent), var(--accent2));color:white;box-shadow:0 12px 22px rgba(43,140,255,.25)}
    .btn-ghost{background:rgba(255,255,255,.06);border:1px solid var(--line);color:var(--text);flex:0 0 auto;padding:14px 16px}
    .btn:active{transform:translateY(1px)}
    .toast{
      position:fixed;left:50%;bottom:16px;transform:translateX(-50%);
      background:rgba(0,0,0,.72);border:1px solid var(--line);
      color:var(--text);padding:10px 12px;border-radius:14px;
      font-size:13px;max-width:92vw;box-shadow:var(--shadow2);
      opacity:0;pointer-events:none;transition:opacity .18s ease;z-index:50;
    }
    .toast.show{opacity:1}
    .footer-note{text-align:center;margin-top:10px;font-size:11px;color:rgba(155,176,210,.65)}

    /* NEW: slick bottom-sheet help */
    .sheet-backdrop{
      position:fixed;inset:0;
      background:rgba(0,0,0,.55);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      display:none;
      align-items:flex-end;
      justify-content:center;
      padding:12px;
      z-index:80;
    }
    .sheet{
      width:min(560px, 100%);
      background:linear-gradient(180deg, rgba(16,27,51,.98), rgba(12,20,40,.96));
      border:1px solid rgba(255,255,255,.10);
      border-radius:24px;
      box-shadow:var(--shadow);
      overflow:hidden;
      transform:translateY(18px);
      opacity:0;
      transition: transform .18s ease, opacity .18s ease;
    }
    .sheet-backdrop.show .sheet{transform:translateY(0);opacity:1}
    .sheet-top{
      padding:12px 14px 10px;
      display:flex;align-items:center;justify-content:space-between;gap:10px;
      border-bottom:1px solid rgba(255,255,255,.08);
    }
    .grab{width:40px;height:5px;border-radius:999px;background:rgba(255,255,255,.12);margin:8px auto 0}
    .sheet-title{display:flex;flex-direction:column;gap:2px}
    .sheet-title b{font-size:14px}
    .sheet-title span{font-size:12px;color:var(--muted)}
    .sheet-close{
      border:1px solid rgba(255,255,255,.10);
      background:rgba(255,255,255,.06);
      color:var(--text);
      border-radius:14px;
      padding:8px 10px;
      cursor:pointer;
      font-weight:900;
    }
    .sheet-body{
      padding:12px 14px 14px;
      max-height:72vh;
      overflow:auto;
    }
    details{
      border:1px solid rgba(255,255,255,.09);
      background:rgba(255,255,255,.04);
      border-radius:18px;
      padding:10px 12px;
      margin:10px 0;
    }
    summary{
      cursor:pointer;
      font-weight:850;
      list-style:none;
      display:flex;align-items:center;justify-content:space-between;gap:10px;
      font-size:13px;
    }
    summary::-webkit-details-marker{display:none}
    .chev{opacity:.7}
    details[open] .chev{transform:rotate(180deg)}
    .sheet p, .sheet li{color:var(--muted);font-size:13px;line-height:1.45}
    .kb{
      background:rgba(0,0,0,.25);
      border:1px solid rgba(255,255,255,.10);
      padding:10px 12px;border-radius:16px;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      white-space:pre-wrap;font-size:12px;color:#d9e6ff;
      margin-top:8px;
    }
    .mini-actions{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
    .mini{
      border:1px solid rgba(255,255,255,.10);
      background:rgba(255,255,255,.06);
      color:var(--text);
      border-radius:14px;
      padding:10px 12px;
      cursor:pointer;
      font-weight:850;
      font-size:13px;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="header">
      <div class="brand">
        <div class="logo"></div>
        <div class="title">
          <h1>üéµ –ú—É–∑—ã–∫–∞ –±—É–¥—É—â–µ–≥–æ</h1>
          <div>–°–¥–µ–ª–∞–π —Ç—Ä–µ–∫ –∏–∑ –∏–¥–µ–∏ –∏–ª–∏ —Ç–µ–∫—Å—Ç–∞</div>
        </div>
      </div>
      <button class="btn-help" id="helpBtn">–ü–æ–¥—Å–∫–∞–∑–∫–∏</button>
    </div>

    <div class="card">
      <label>–†–µ–∂–∏–º</label>
      <div class="pillset" role="tablist" aria-label="mode">
        <div class="pill active" id="modePrompt">‚ú® –ü–æ –æ–ø–∏—Å–∞–Ω–∏—é</div>
        <div class="pill" id="modeLyrics">‚úçÔ∏è –ü–æ —Ç–µ–∫—Å—Ç—É</div>
      </div>

      <div class="row">
        <div style="flex:1;min-width:160px">
          <label>–ù–∞–∑–≤–∞–Ω–∏–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
          <input id="title" placeholder="–ù–∞–ø—Ä.: –ú—É–∑—ã–∫–∞ –±—É–¥—É—â–µ–≥–æ" maxlength="80" />
        </div>
        <div style="flex:1;min-width:160px">
          <label>–¢–µ–≥–∏ (—Å—Ç–∏–ª—å/–∂–∞–Ω—Ä)</label>
          <input id="tags" placeholder="pop, upbeat, russian, viral hook" maxlength="140" />
          <div class="hint">–¢–µ–≥–∏ —Å–∏–ª—å–Ω–µ–µ –≤—Å–µ–≥–æ –≤–ª–∏—è—é—Ç –Ω–∞ —Å—Ç–∏–ª—å: –∂–∞–Ω—Ä, –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ, –≤–æ–∫–∞–ª, –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã.</div>
        </div>
      </div>

      <div class="row" style="margin-top:10px">
        <div style="flex:1;min-width:160px">
          <label>–Ø–∑—ã–∫</label>
          <select id="language">
            <option value="auto">–ê–≤—Ç–æ</option>
            <option value="ru">–†—É—Å—Å–∫–∏–π</option>
            <option value="en">English</option>
          </select>
        </div>
        <div style="flex:1;min-width:160px">
          <label>–ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ</label>
          <select id="mood">
            <option value="auto">–ê–≤—Ç–æ</option>
            <option value="upbeat">–≠–Ω–µ—Ä–≥–∏—á–Ω–∞—è</option>
            <option value="calm">–°–ø–æ–∫–æ–π–Ω–∞—è</option>
            <option value="sad">–ì—Ä—É—Å—Ç–Ω–∞—è</option>
            <option value="inspiring">–í–¥–æ—Ö–Ω–æ–≤–ª—è—é—â–∞—è</option>
            <option value="dark">–¢—ë–º–Ω–∞—è</option>
          </select>
        </div>
      </div>

      <div class="divider"></div>

      <div class="switch">
        <input type="checkbox" id="instrumental" />
        <div>
          <b>–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–ª (–±–µ–∑ –≤–æ–∫–∞–ª–∞)</b>
          <div class="hint" style="margin:4px 0 0 0">–ï—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ ‚Äî –±—É–¥–µ—Ç —á–∏—Å—Ç–∞—è –º—É–∑—ã–∫–∞.</div>
        </div>
      </div>

      <div id="promptBlock">
        <label>–û–ø–∏—à–∏ –ø–µ—Å–Ω—é</label>
        <textarea id="desc" placeholder="–ñ–∞–Ω—Ä, –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ, —Ç–µ–º–∞, —è–∑—ã–∫, —Ä–µ—Ñ–µ—Ä–µ–Ω—Å—ã. –ü—Ä–∏–º–µ—Ä: Upbeat Russian pop about AI videos in Telegram, catchy hook, modern sound"></textarea>
        <div class="hint">–≠—Ç–æ—Ç —Ä–µ–∂–∏–º –ø—Ä–æ—â–µ: —Ç—ã –¥–∞—ë—à—å –∏–¥–µ—é ‚Äî –ò–ò —Å–∞–º –ø—Ä–∏–¥—É–º–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∏ —Å–ª–æ–≤–∞.</div>
      </div>

      <div id="lyricsBlock" style="display:none">
        <label>–¢–µ–∫—Å—Ç –ø–µ—Å–Ω–∏</label>
        <textarea id="lyrics" placeholder="[Verse]\n...\n\n[Chorus]\n...\n\n(–ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–ª—è—Ç—å –ø–æ–¥—Å–∫–∞–∑–∫–∏ –≤ —Å–∫–æ–±–∫–∞—Ö: (—ç–Ω–µ—Ä–≥–∏—á–Ω–æ), (—à—ë–ø–æ—Ç–æ–º), (–∫—É–ª—å–º–∏–Ω–∞—Ü–∏—è))"></textarea>

        <div class="actions">
          <button class="btn btn-ghost" id="tplBtn" type="button">–í—Å—Ç–∞–≤–∏—Ç—å —à–∞–±–ª–æ–Ω</button>
          <button class="btn btn-ghost" id="tagBtn" type="button">–ü—Ä–∏–º–µ—Ä —Ç–µ–≥–æ–≤</button>
        </div>

        <div class="hint">–°–µ–∫—Ü–∏–∏ <b>[Verse]</b>, <b>[Chorus]</b>, <b>[Bridge]</b>. –°–∫–æ–±–∫–∏ ‚Äî –ø–æ–¥—Å–∫–∞–∑–∫–∏ –¥–ª—è –ø–æ–¥–∞—á–∏ (–Ω–µ –æ–±—è–∑.).</div>
      </div>

      <div class="actions" style="margin-top:14px">
        <button class="btn btn-primary" id="sendBtn" type="button">‚úÖ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏ –≤–µ—Ä–Ω—É—Ç—å—Å—è –≤ –±–æ—Ç</button>
      </div>

      <div class="footer-note">@NeiroAstraBot</div>
    </div>
  </div>

  <div class="toast" id="toast"></div>

  <!-- NEW HELP SHEET -->
  <div class="sheet-backdrop" id="sheetBackdrop">
    <div class="sheet" role="dialog" aria-modal="true" aria-label="help">
      <div class="grab"></div>
      <div class="sheet-top">
        <div class="sheet-title">
          <b>–ü–æ–¥—Å–∫–∞–∑–∫–∏ –ø–æ –º—É–∑—ã–∫–µ</b>
          <span>2 –º–∏–Ω—É—Ç—ã ‚Äî –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Å—Ç–∞–Ω–µ—Ç –ª—É—á—à–µ</span>
        </div>
        <button class="sheet-close" id="sheetClose">‚úï</button>
      </div>
      <div class="sheet-body">
        <details open>
          <summary>‚ú® –†–µ–∂–∏–º—ã: –ø–æ –æ–ø–∏—Å–∞–Ω–∏—é / –ø–æ —Ç–µ–∫—Å—Ç—É <span class="chev">‚ñæ</span></summary>
          <ul>
            <li><b>–ü–æ –æ–ø–∏—Å–∞–Ω–∏—é</b> ‚Äî —Ç—ã –ø–∏—à–µ—à—å –∏–¥–µ—é (–∂–∞–Ω—Ä/–≤–∞–π–±/—Ç–µ–º–∞), –ò–ò —Å–∞–º –¥–µ–ª–∞–µ—Ç —Å–ª–æ–≤–∞ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—É.</li>
            <li><b>–ü–æ —Ç–µ–∫—Å—Ç—É</b> ‚Äî —Ç—ã –≤—Å—Ç–∞–≤–ª—è–µ—à—å —Ç–µ–∫—Å—Ç, —ç—Ç–æ –±–æ–ª—å—à–µ –∫–æ–Ω—Ç—Ä–æ–ª—è –Ω–∞–¥ –∫—É–ø–ª–µ—Ç–∞–º–∏/–ø—Ä–∏–ø–µ–≤–æ–º.</li>
          </ul>
        </details>

        <details>
          <summary>‚úçÔ∏è –ö–∞–∫ –∑–∞–¥–∞–≤–∞—Ç—å –∫—É–ø–ª–µ—Ç/–ø—Ä–∏–ø–µ–≤ <span class="chev">‚ñæ</span></summary>
          <p>–ò—Å–ø–æ–ª—å–∑—É–π —Å–µ–∫—Ü–∏–∏. –°–∞–º–æ–µ –ø—Ä–æ—Å—Ç–æ–µ:</p>
          <div class="kb">[Verse]
–¢–µ–∫—Å—Ç –∫—É–ø–ª–µ—Ç–∞...

[Chorus]
–¢–µ–∫—Å—Ç –ø—Ä–∏–ø–µ–≤–∞...

[Verse]
–í—Ç–æ—Ä–æ–π –∫—É–ø–ª–µ—Ç...

[Bridge]
–ö–æ–Ω—Ç—Ä–∞—Å—Ç/–∫—É–ª—å–º–∏–Ω–∞—Ü–∏—è...

[Chorus]
–§–∏–Ω–∞–ª—å–Ω—ã–π –ø—Ä–∏–ø–µ–≤...</div>
          <div class="mini-actions">
            <button class="mini" id="copyStruct" type="button">–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É</button>
          </div>
        </details>

        <details>
          <summary>üß† –°–∫–æ–±–∫–∏ –∏ —Ç–µ–≥–∏ ‚Äî ‚Äú—Ñ–∏—à–∫–∞‚Äù <span class="chev">‚ñæ</span></summary>
          <p><b>–°–∫–æ–±–∫–∏</b> ‚Äî –º—è–≥–∫–∏–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏ –¥–ª—è –ø–æ–¥–∞—á–∏ (–ò–ò –æ–±—ã—á–Ω–æ –Ω–µ –ø–æ—ë—Ç –∏—Ö –±—É–∫–≤–∞–ª—å–Ω–æ):</p>
          <div class="kb">[Chorus]
(–æ—á–µ–Ω—å —Ü–µ–ø–ª—è—é—â–∏–π, –∫–æ—Ä–æ—Ç–∫–∏–µ —Å—Ç—Ä–æ–∫–∏)
–ú—É–∑—ã–∫–∞ –±—É–¥—É—â–µ–≥–æ ‚Äî –≤ –æ–¥–∏–Ω –∫–ª–∏–∫...</div>
          <p style="margin-top:10px"><b>–¢–µ–≥–∏</b> ‚Äî —Å–∞–º–æ–µ –≤–∞–∂–Ω–æ–µ –¥–ª—è —Å—Ç–∏–ª—è (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é): –∂–∞–Ω—Ä, –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ, –≤–æ–∫–∞–ª, –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã.</p>
          <div class="kb">russian pop, upbeat, modern, catchy hook, club beat, female vocal</div>
        </details>

        <details>
          <summary>‚úÖ –ó–æ–ª–æ—Ç–æ–µ –ø—Ä–∞–≤–∏–ª–æ <span class="chev">‚ñæ</span></summary>
          <ul>
            <li><b>–¢–µ–∫—Å—Ç</b> = —Å–º—ã—Å–ª –∏ —Å–ª–æ–≤–∞</li>
            <li><b>–¢–µ–≥–∏</b> = –∂–∞–Ω—Ä –∏ –≤–∞–π–±</li>
            <li><b>–°–∫–æ–±–∫–∏</b> = –ø–æ–¥–∞—á–∞/–Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</li>
          </ul>
        </details>
      </div>
    </div>
  </div>

  <script>
    const tg = window.Telegram?.WebApp;
    if (tg) tg.ready();

    const els = {
      modePrompt: document.getElementById('modePrompt'),
      modeLyrics: document.getElementById('modeLyrics'),
      promptBlock: document.getElementById('promptBlock'),
      lyricsBlock: document.getElementById('lyricsBlock'),
      title: document.getElementById('title'),
      tags: document.getElementById('tags'),
      desc: document.getElementById('desc'),
      lyrics: document.getElementById('lyrics'),
      instrumental: document.getElementById('instrumental'),
      language: document.getElementById('language'),
      mood: document.getElementById('mood'),
      sendBtn: document.getElementById('sendBtn'),
      toast: document.getElementById('toast'),
      tplBtn: document.getElementById('tplBtn'),
      tagBtn: document.getElementById('tagBtn'),
      helpBtn: document.getElementById('helpBtn'),
      sheetBackdrop: document.getElementById('sheetBackdrop'),
      sheetClose: document.getElementById('sheetClose'),
      copyStruct: document.getElementById('copyStruct'),
    };

    let mode = "prompt";

    function setMode(next){
      mode = next;
      if (mode === "prompt"){
        els.modePrompt.classList.add('active');
        els.modeLyrics.classList.remove('active');
        els.promptBlock.style.display = '';
        els.lyricsBlock.style.display = 'none';
      } else {
        els.modeLyrics.classList.add('active');
        els.modePrompt.classList.remove('active');
        els.promptBlock.style.display = 'none';
        els.lyricsBlock.style.display = '';
      }
    }

    function showToast(msg){
      els.toast.textContent = msg;
      els.toast.classList.add('show');
      setTimeout(()=>els.toast.classList.remove('show'), 1800);
    }

    function openSheet(){
      els.sheetBackdrop.style.display = 'flex';
      requestAnimationFrame(()=>els.sheetBackdrop.classList.add('show'));
    }
    function closeSheet(){
      els.sheetBackdrop.classList.remove('show');
      setTimeout(()=>{ els.sheetBackdrop.style.display = 'none'; }, 160);
    }

    els.helpBtn.addEventListener('click', openSheet);
    els.sheetClose.addEventListener('click', closeSheet);
    els.sheetBackdrop.addEventListener('click', (e)=>{ if(e.target === els.sheetBackdrop) closeSheet(); });

    els.modePrompt.addEventListener('click', ()=>setMode("prompt"));
    els.modeLyrics.addEventListener('click', ()=>setMode("lyrics"));

    els.tplBtn.addEventListener('click', ()=>{
      const tpl = `[Verse]
(—Ä–∞–∑–≥–æ–≤–æ—Ä–Ω—ã–π —Å—Ç–∏–ª—å, —É–≤–µ—Ä–µ–Ω–Ω–∞—è –ø–æ–¥–∞—á–∞)
...

[Pre-Chorus]
(–ø–æ–¥–≤–æ–¥–∫–∞ –∫ –ø—Ä–∏–ø–µ–≤—É)
...

[Chorus]
(–æ—á–µ–Ω—å —Ü–µ–ø–ª—è—é—â–∏–π, –∫–æ—Ä–æ—Ç–∫–∏–µ —Å—Ç—Ä–æ–∫–∏)
...

[Verse]
...

[Chorus]
...

[Bridge]
(–∫–æ–Ω—Ç—Ä–∞—Å—Ç/–∫—É–ª—å–º–∏–Ω–∞—Ü–∏—è)
...

[Chorus]
...`;
      els.lyrics.value = tpl;
      showToast("–®–∞–±–ª–æ–Ω –≤—Å—Ç–∞–≤–ª–µ–Ω ‚úÖ");
    });

    els.tagBtn.addEventListener('click', ()=>{
      els.tags.value = "russian pop, upbeat, modern, catchy hook, club beat, female vocal";
      showToast("–ü—Ä–∏–º–µ—Ä —Ç–µ–≥–æ–≤ –≤—Å—Ç–∞–≤–ª–µ–Ω ‚úÖ");
    });

    els.copyStruct.addEventListener('click', async ()=>{
      const txt = `[Verse]
...

[Chorus]
...

[Verse]
...

[Bridge]
...

[Chorus]
...`;
      try{
        await navigator.clipboard.writeText(txt);
        showToast("–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ ‚úÖ");
      } catch(e){
        showToast("–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å");
      }
    });

    function buildPayload(){
      const payload = {
        flow: "music",
        mode,
        title: (els.title.value || "").trim(),
        tags: (els.tags.value || "").trim(),
        make_instrumental: !!els.instrumental.checked,
        language: els.language.value,
        mood: els.mood.value
      };
      if (mode === "prompt"){
        payload.gpt_description_prompt = (els.desc.value || "").trim();
      } else {
        payload.prompt = (els.lyrics.value || "").trim();
      }
      return payload;
    }

    function validate(p){
      if (p.mode === "prompt" && !p.gpt_description_prompt) return "–û–ø–∏—à–∏ –ø–µ—Å–Ω—é (–∏–¥–µ—è/—Å—Ç–∏–ª—å/–Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ).";
      if (p.mode === "lyrics" && !p.prompt) return "–í—Å—Ç–∞–≤—å —Ç–µ–∫—Å—Ç –ø–µ—Å–Ω–∏ (lyrics).";
      return null;
    }

    els.sendBtn.addEventListener('click', ()=>{
      const payload = buildPayload();
      const err = validate(payload);
      if (err){ showToast(err); return; }
      try{
        if (tg && tg.sendData){
          tg.sendData(JSON.stringify(payload));
          showToast("–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ ‚úÖ –í–æ–∑–≤—Ä–∞—â–∞—é—Å—å –≤ –±–æ—Ç...");
          setTimeout(()=>tg.close(), 450);
        } else {
          console.log("Payload:", payload);
          showToast("–û—Ç–∫—Ä–æ–π —á–µ—Ä–µ–∑ Telegram WebApp.");
        }
      } catch(e){
        console.error(e);
        showToast("–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö.");
      }
    });

    setMode("prompt");
  </script>
</body>
</html>
