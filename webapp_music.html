<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>–ú—É–∑—ã–∫–∞ –±—É–¥—É—â–µ–≥–æ ‚Äî –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</title>
  <style>
    :root{
      --bg:#060b16;
      --card:#0b1430;
      --card2:#0a1228;
      --text:#e8eefc;
      --muted:#9fb0d4;
      --stroke:rgba(170,190,255,.16);
      --accent:#2ea6ff;
      --accent2:#1f6feb;
      --danger:#ff4d4d;
      --shadow:0 12px 30px rgba(0,0,0,.35);
      --radius:18px;
    }
    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans";
      background: radial-gradient(1200px 500px at 30% -10%, rgba(46,166,255,.18), transparent 60%),
                  radial-gradient(900px 400px at 90% 10%, rgba(31,111,235,.16), transparent 55%),
                  var(--bg);
      color:var(--text);
    }
    .wrap{ padding:18px 16px 28px; max-width:760px; margin:0 auto; }
    .h1{ font-size:22px; font-weight:800; letter-spacing:.2px; margin:6px 0 6px; }
    .sub{ color:var(--muted); font-size:13px; line-height:1.45; margin:0 0 14px; }
    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      border:1px solid var(--stroke);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding:14px;
      margin:12px 0;
    }
    .row{ display:flex; gap:10px; flex-wrap:wrap; }
    .col{ flex:1 1 240px; min-width:240px; }
    label{ display:block; font-size:12px; color:var(--muted); margin:10px 0 6px; }
    input[type="text"], select, textarea{
      width:100%;
      border-radius:14px;
      border:1px solid var(--stroke);
      background: rgba(10,18,40,.6);
      color: var(--text);
      padding:12px 12px;
      outline:none;
      font-size:14px;
    }
    textarea{ min-height:120px; resize:vertical; }
    .pill{
      display:inline-flex; gap:8px; align-items:center;
      padding:8px 10px;
      border-radius:999px;
      border:1px solid var(--stroke);
      background: rgba(10,18,40,.55);
      color: var(--text);
      font-size:13px;
      cursor:pointer;
      user-select:none;
    }
    .pill input{ accent-color: var(--accent); }
    .tabs{ display:flex; gap:10px; flex-wrap:wrap; margin-top:6px; }
    .tab{
      flex:1 1 140px;
      padding:10px 12px;
      border-radius:14px;
      border:1px solid var(--stroke);
      background: rgba(10,18,40,.55);
      color: var(--text);
      text-align:center;
      font-weight:700;
      cursor:pointer;
    }
    .tab.active{
      border-color: rgba(46,166,255,.55);
      background: rgba(46,166,255,.14);
    }
    .btn{
      width:100%;
      border:0;
      border-radius:16px;
      padding:14px 14px;
      font-size:15px;
      font-weight:900;
      color:white;
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      cursor:pointer;
      margin-top:10px;
    }
    .hint{ font-size:12px; color:var(--muted); margin-top:8px; line-height:1.4; }
    .debug{
      font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
      font-size:12px;
      white-space:pre-wrap;
      word-break:break-word;
      color:#cfe2ff;
      background: rgba(0,0,0,.25);
      border:1px solid var(--stroke);
      border-radius: 14px;
      padding:10px;
      margin-top:10px;
      display:none;
    }
    .toast{
      position: fixed;
      left: 50%;
      transform: translateX(-50%);
      bottom: 18px;
      background: rgba(0,0,0,.72);
      border: 1px solid var(--stroke);
      color: var(--text);
      padding: 10px 12px;
      border-radius: 12px;
      font-size: 13px;
      display:none;
      z-index: 9999;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="h1">üéµ –ú—É–∑—ã–∫–∞ –±—É–¥—É—â–µ–≥–æ</div>
    <div class="sub">–ù–∞—Å—Ç—Ä–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –º—É–∑—ã–∫–∏ —á–µ—Ä–µ–∑ PiAPI (Suno V5). –ú–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å —Ä–µ–∂–∏–º: <b>–ø–æ –æ–ø–∏—Å–∞–Ω–∏—é</b> –∏–ª–∏ <b>–ø–æ –≥–æ—Ç–æ–≤–æ–º—É —Ç–µ–∫—Å—Ç—É</b>.</div>

    <div class="card">
      <div class="row">
        <div class="col">
          <label>–í–µ—Ä—Å–∏—è Suno (mv)</label>
          <select id="mv">
            <option value="chirp-crow" selected>chirp-crow (v5)</option>
          </select>
        </div>
        <div class="col">
          <label>–†–µ–∂–∏–º –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏</label>
          <div class="tabs" role="tablist">
            <div class="tab active" id="tabPrompt" data-mode="prompt">–ü–æ –æ–ø–∏—Å–∞–Ω–∏—é</div>
            <div class="tab" id="tabCustom" data-mode="custom">–ü–æ —Ç–µ–∫—Å—Ç—É (lyrics)</div>
          </div>
        </div>
      </div>

      <div class="row">
        <div class="col">
          <label>–ù–∞–∑–≤–∞–Ω–∏–µ (title)</label>
          <input id="title" type="text" placeholder="–ù–∞–ø—Ä.: –ú—É–∑—ã–∫–∞ –±—É–¥—É—â–µ–≥–æ" />
        </div>
        <div class="col">
          <label>–¢–µ–≥–∏ (tags)</label>
          <input id="tags" type="text" placeholder="–ù–∞–ø—Ä.: pop, upbeat, russian, viral hook" />
        </div>
      </div>

      <label>–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–ª (–±–µ–∑ –≤–æ–∫–∞–ª–∞)</label>
      <div class="pill"><input id="instrumental" type="checkbox" /> <span>make_instrumental = true</span></div>

      <div id="promptBlock">
        <label>–û–ø–∏—Å–∞–Ω–∏–µ (gpt_description_prompt)</label>
        <textarea id="desc" placeholder="–û–ø–∏—à–∏ –º—É–∑—ã–∫—É: –∂–∞–Ω—Ä, –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ, —Ç–µ–º–∞, —è–∑—ã–∫, —Ä–µ—Ñ–µ—Ä–µ–Ω—Å—ã. –ü—Ä–∏–º–µ—Ä: 'Upbeat Russian pop about AI videos in Telegram, catchy hook, modern sound'"></textarea>
        <div class="hint">–≠—Ç–æ—Ç —Ä–µ–∂–∏–º –ø—Ä–æ—â–µ: —Ç—ã –¥–∞—ë—à—å –æ–ø–∏—Å–∞–Ω–∏–µ, –º–æ–¥–µ–ª—å —Å–∞–º–∞ —Å—Ñ–æ—Ä–º–∏—Ä—É–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É.</div>
      </div>

      <div id="customBlock" style="display:none;">
        <label>–¢–µ–∫—Å—Ç –ø–µ—Å–Ω–∏ (prompt / lyrics)</label>
        <textarea id="lyrics" placeholder="[Verse]\n...\n\n[Chorus]\n..."></textarea>
        <div class="hint">–≠—Ç–æ—Ç —Ä–µ–∂–∏–º –¥–∞—ë—Ç –±–æ–ª—å—à–µ –∫–æ–Ω—Ç—Ä–æ–ª—è: —Ç—ã —Å–∞–º –∑–∞–¥–∞—ë—à—å –∫—É–ø–ª–µ—Ç—ã/–ø—Ä–∏–ø–µ–≤—ã.</div>
      </div>
    </div>

    <div class="card">
      <div class="row">
        <div class="col">
          <label>–°–µ—Ä–≤–∏—Å–Ω—ã–π —Ä–µ–∂–∏–º (service_mode)</label>
          <select id="serviceMode">
            <option value="" selected>–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (–∫–∞–∫ –≤ Workspace)</option>
            <option value="public">public (PAYG)</option>
            <option value="private">private (HYA)</option>
          </select>
        </div>
        <div class="col">
          <label>–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (—Å–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–∞ –±—É–¥—É—â–µ–µ)</label>
          <input id="language" type="text" placeholder="–Ø–∑—ã–∫ (RU/EN) ‚Äî –ø–æ–∫–∞ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ" />
        </div>
      </div>

      <label>Debug (–ø–æ–∫–∞–∑–∞—Ç—å JSON, –∫–æ—Ç–æ—Ä—ã–π —É–π–¥—ë—Ç –≤ –±–æ—Ç–∞)</label>
      <div class="pill"><input id="debugToggle" type="checkbox" /> <span>–ø–æ–∫–∞–∑–∞—Ç—å payload</span></div>
      <div id="debug" class="debug"></div>

      <button class="btn" id="sendBtn">‚úÖ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏ –≤–µ—Ä–Ω—É—Ç—å—Å—è –≤ –±–æ—Ç</button>
      <div class="hint">–ü–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –±–æ—Ç –ø–æ–ø—Ä–æ—Å–∏—Ç —Ç–µ–∫—Å—Ç/–æ–ø–∏—Å–∞–Ω–∏–µ, –µ—Å–ª–∏ –ø–æ–ª–µ –ø—É—Å—Ç–æ–µ. –ï—Å–ª–∏ —Ç—ã —É–∂–µ –∑–∞–ø–æ–ª–Ω–∏–ª –æ–ø–∏—Å–∞–Ω–∏–µ/—Ç–µ–∫—Å—Ç ‚Äî –±–æ—Ç –º–æ–∂–µ—Ç –Ω–∞—á–∞—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏—é —Å—Ä–∞–∑—É.</div>
    </div>

    <div class="toast" id="toast">–î–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã. –ú–æ–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å—Å—è –≤ Telegram.</div>
  </div>

  <script>
    const tg = window.Telegram && window.Telegram.WebApp ? window.Telegram.WebApp : null;
    if (tg){
      tg.ready();
      tg.expand();
    }

    const qs = (s) => document.querySelector(s);
    const tabPrompt = qs('#tabPrompt');
    const tabCustom = qs('#tabCustom');
    const promptBlock = qs('#promptBlock');
    const customBlock = qs('#customBlock');

    let musicMode = 'prompt';

    function setMode(mode){
      musicMode = mode;
      tabPrompt.classList.toggle('active', mode === 'prompt');
      tabCustom.classList.toggle('active', mode === 'custom');
      promptBlock.style.display = (mode === 'prompt') ? 'block' : 'none';
      customBlock.style.display = (mode === 'custom') ? 'block' : 'none';
      renderDebug();
    }

    tabPrompt.addEventListener('click', () => setMode('prompt'));
    tabCustom.addEventListener('click', () => setMode('custom'));

    function buildPayload(){
      const payload = {
        flow: "music",
        provider: "piapi",
        model: "suno",
        task_type: "music",
        mv: qs('#mv').value,
        music_mode: musicMode,
        title: qs('#title').value.trim(),
        tags: qs('#tags').value.trim(),
        make_instrumental: !!qs('#instrumental').checked,
        service_mode: qs('#serviceMode').value,
        language: qs('#language').value.trim()
      };

      const desc = qs('#desc').value.trim();
      const lyrics = qs('#lyrics').value.trim();

      if (musicMode === 'prompt'){
        payload.gpt_description_prompt = desc;
      } else {
        payload.prompt = lyrics;
      }
      return payload;
    }

    function renderDebug(){
      const on = qs('#debugToggle').checked;
      const box = qs('#debug');
      if(!on){
        box.style.display = 'none';
        return;
      }
      box.style.display = 'block';
      box.textContent = JSON.stringify(buildPayload(), null, 2);
    }

    qs('#debugToggle').addEventListener('change', renderDebug);
    qs('#title').addEventListener('input', renderDebug);
    qs('#tags').addEventListener('input', renderDebug);
    qs('#instrumental').addEventListener('change', renderDebug);
    qs('#desc').addEventListener('input', renderDebug);
    qs('#lyrics').addEventListener('input', renderDebug);
    qs('#serviceMode').addEventListener('change', renderDebug);
    qs('#language').addEventListener('input', renderDebug);

    function showToast(){
      const t = qs('#toast');
      t.style.display = 'block';
      setTimeout(() => { t.style.display = 'none'; }, 2600);
    }

    qs('#sendBtn').addEventListener('click', () => {
      const payload = buildPayload();
      renderDebug();

      if (tg){
        try{ tg.sendData(JSON.stringify(payload)); }catch(e){}
        setTimeout(() => {
          try{ tg.close(); }catch(e){}
          showToast();
        }, 150);
      } else {
        // browser test
        console.log(payload);
        showToast();
      }
    });
  </script>
</body>
</html>
